---
layout: post
title: "TCP 하이재킹"
date: 2016-12-20
categories: ['security']
---
- 세션하이재킹이란?
    - TCP 세션 하이재킹은 TCP가 가지는 고유한
취약점을 이용해 정상적인 접속(session)을
빼앗는 방법이다.
    - TCP는 클라이언트와 서버 간 통신을 할 때
패킷의 연속성을 보장하기 위해 클라이언트
와 서버에 각각 시퀀스 넘버를 사용한다.
    - 시퀀스 넘버가 잘못되면 이를 바로 잡기 위
한 작업을 하는데, TCP 세션 하이재킹은 서
버와 클라이언트에 각각 잘못된 시퀀스 넘버
를 위조해서 연결된 세션에 잠시 혼란을 준
뒤 자신이 끼어들어가는 방식을 사용한다.
![alt text](/public/img/TCP_1.png)

##### 기본적단계
###### ① 클라이언트와 서버 사이의 패킷을 통제한다. ARP 스푸핑 등을 통해 클라이언트와서버 사이의 통신 패킷 모두가 공격자를 지나가지 않게 한다.
###### ② 서버에 클라이언트 주소로 연결을 재설정하기 위한 RST(Reset) 패킷을 보낸다. 서버는 해당 패킷을 받고, 클라이언트의 시퀀스 넘버가 재설정된 것으로 판단하고, 다시 TCP 3-웨이 핸드셰이킹을 수행한다.
###### ③ 공격자는 클라이언트 대신 연결되어 있던 TCP 연결을 그대로 물려받는다. 이 3단계를 거치면, 공격자는 클라이언트가 텔넷 등을 통해 열어놓은 세션을 아이디와 패스워드 입력 없이 그대로 획득할 수 있다.

- 실습환경

![alt text](/public/img/TCP_2.PNG)

##### yum 명령어로 hunt 설치하기

![alt text](/public/img/TCP_3.PNG)

- 실습

![alt text](/public/img/TCP_4.PNG)

![alt text](/public/img/TCP_5.PNG)

![alt text](/public/img/TCP_6.PNG)

![alt text](/public/img/TCP_7.PNG)

![alt text](/public/img/TCP_8.PNG)

![alt text](/public/img/TCP_9.PNG)

![alt text](/public/img/TCP_10.PNG)

- 대응책
    - 탐지
        - 비동기화 상태 탐지
        - ACK Storm 탐지
        - 패킷의 유실과 재전송 증가 탐지
        - 인증되지 않은 접속의 리셋
    - 대응
        - 데이터 전송의 암호화와 지속적인 인증을통한 세션의 유효성을 확인한다.

- 실습 후
    - 공격자는 서버한테 RST패킷을 보내 일시적으로 TCP 세션을 끊고 시퀀스 넘버를 새로 생성하여 보냄으로써 세션을 뺏아게 된다. 우리는 서버와 시퀀스 넘버를 주기적으로 체크하여 비동기화 상태에 빠지게 된다면 TCP 하이재킹을 의심해 봐야할거 같다.

